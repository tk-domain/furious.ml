define(["jquery","globals","backbone","underscore","js-cookie"],function(i,e,t,n,s){var a=function(i){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(i)},o=function(i){var e=i.trim(),t=e.match(/[a-zA-Z]+/);return null!=t&&e===t[0]},r=t.View.extend({className:"modal fade",insertErrorMessage:function(i,e){this.$("."+i).addClass("has-error"),this.$("."+i+" .help-block").html(e)},insertGenericErrorMessage:function(i){this.$(".error").html("<div class='alert alert-danger fade in'><a href='#' class='close' data-dismiss='alert' aria-label='close'>&times;</a>"+i+"</div>"),this.$(".error .alert").delay(1e3).slideUp(200,function(){this.$(".error .alert").alert("close")}.bind(this))}}),l=r.extend({initialize:function(i){this.switchView=!1,this.template=i.LoginModalTemplate},events:{"click .btn-login":"nativeLogin","click .btn-primary-fb":"fbLogin","click .signupModal":"onSignupClicked"},onSignupClicked:function(){this.switchView=!0},open:function(){this.render(),this.$el.modal("show")},render:function(){this.$el.html(this.template()),this.$el.on("hide.bs.modal",function(i){this.switchView?setTimeout(function(){this.switchView=!1}.bind(this),1):this.model.onModalClose()}.bind(this)),this.$("input").keypress(this.onKeyPress.bind(this))},onKeyPress:function(i){13==i.keyCode&&this.nativeLogin()},fbLogin:function(){this.model.signInFacebook(),e.loginModel.addOneSignInCallback(this.onLogin.bind(this)),e.loginModel.addOneSignInFailCallback(function(){this.$el.modal("hide")}.bind(this))},nativeLogin:function(){this.$(".form-group").removeClass("has-error"),this.$(".form-group .help-block").html("");var i=this.$("input[name=login_username]").val(),t=this.$("input[name=login_password]").val();i&&t?a(i)?(this.model.signInNative(i,t),e.loginModel.addOneSignInCallback(this.onLogin.bind(this)),e.loginModel.addOneSignInFailCallback(this.onFailedLogin.bind(this))):this.insertErrorMessage("username","Invalid username"):i?this.insertErrorMessage("password","Please enter a password"):this.insertErrorMessage("username","Please enter an username")},onLogin:function(){this.$("#login_username").val(""),this.$("#login_password").val(""),this.$el.modal("hide")},onFailedLogin:function(i){this.insertGenericErrorMessage(i.errorMessage)}}),h=r.extend({initialize:function(i){this.switchView=!1,this.recaptchaKey=null,this.template=i.SignupModalTemplate,e.RecaptchaDeferred.done(this.onRecaptchaLoad.bind(this))},events:{"click .btn-signup":"signup","click .btn-primary-fb":"fbLogin","click .loginModal":"onLoginClicked"},render:function(){this.$el.html(this.template()),this.$el.on("hide.bs.modal",function(i){this.switchView?setTimeout(function(){this.switchView=!1}.bind(this),1):this.model.onModalClose()}.bind(this)),this.$("input").keypress(this.onKeyPress.bind(this)),this.$el.on("show.bs.modal",function(i){this.$(".recaptchaBlock").length>0&&this.$(".recaptchaBlock").children().length>0?grecaptcha.reset(this.recaptchaKey):this.$(".recaptchaBlock").length>0&&(this.recaptchaKey=grecaptcha.render("recaptchaSignupBlock",{sitekey:"6Lcobh0TAAAAAN1K9rWeJ8xgl8uYkASWSDLBuKU1",theme:"light",callback:this.onRecaptchaSuccess.bind(this)}))}.bind(this))},onRecaptchaSuccess:function(i){this.$(".btn-signup").removeClass("disabled")},onRecaptchaLoad:function(){this.render()},open:function(){this.render()},onKeyPress:function(i){13==i.keyCode&&this.signup(i)},onLoginClicked:function(){this.switchView=!0},signup:function(i){if(!this.$("btn-signup").hasClass("disabled")){this.$(".form-group").removeClass("has-error"),this.$(".form-group .help-block").html("");var t=this.$("input[name=register_first_name]").val(),n=this.$("input[name=register_last_name]").val(),s=this.$("input[name=register_email]").val(),r=this.$("input[name=register_password]").val();t&&n&&s&&r?a(s)?o(t)?o(n)?r.length<4?this.insertErrorMessage("email","The password must be at least 4 characters."):(this.model.registerNative(t,n,s,r),e.loginModel.addOneSignInCallback(this.onSignup.bind(this)),e.loginModel.addOneSignInFailCallback(this.onFailedSignup.bind(this))):this.insertErrorMessage("last_name","This is not an acceptable name"):this.insertErrorMessage("first_name","This is not an acceptable name"):this.insertErrorMessage("email","That is not a valid email address."):t?n?s?r||this.insertErrorMessage("password","Please enter password"):this.insertErrorMessage("email","Please enter email"):this.insertErrorMessage("last_name","Please enter last name"):this.insertErrorMessage("first_name","Please enter first name")}},fbLogin:function(){this.model.signInFacebook(),e.loginModel.addOneSignInCallback(this.onLogin.bind(this)),e.loginModel.addOneSignInFailCallback(function(){this.$el.modal("hide")}.bind(this))},onLogin:function(){this.$("#login_username").val(""),this.$("#login_password").val(""),this.$el.modal("hide")},onSignup:function(){this.$("#register_first_name").val(""),this.$("#register_last_name").val(""),this.$("#register_email").val(""),this.$("#register_password").val(""),this.$el.modal("hide")},onFailedSignup:function(i){this.insertGenericErrorMessage(i.errorMessage)}}),d=r.extend({initialize:function(i){this.initialState=!0,this.errorMessage="",this.template=i.PasswordModalTemplate},onResetPassword:function(){i.ajax({type:"POST",url:e.PrivateApiFrontendHost+"/api/private/v1.0/user/forgotPassword",data:{email:this.$("#forgot_email_address").val()}}).done(function(i){i.hasOwnProperty("errorMessage")||0==i.length?this.errorMessage=i.errorMessage:(this.initialState=!1,this.render())}.bind(this))},render:function(){this.$el.html(this.template({initialState:this.initialState,errorMessage:this.errorMessage})),this.$el.on("hide.bs.modal",function(){this.initialState=!0}.bind(this)),this.errorMessage="",this.$(".btn-submit").click(this.onResetPassword.bind(this))}}),c=t.View.extend({baseInitialize:function(i){this.template=i.template,this.model.isLoggedIn()||this.resetSignInPromise()},logout:function(){this.model.signOut(),this.onSignout()},resetSignInPromise:function(){e.loginModel.addOneSignInCallback(function(){this.onSignin()}.bind(this)),e.loginModel.addOneSignInFailCallback(function(){setTimeout(function(){this.resetSignInPromise()}.bind(this),1)}.bind(this))},onSignout:function(){this.render(),this.resetSignInPromise()},onSignin:function(){this.render(),this.model.addOneSignOutCallback(function(){this.onSignout()}.bind(this))},render:function(){if(this.model.isLoggedIn()){var i=this.model.user.toJSON();i.firstName||(i.firstName=""),i.lastName||(i.lastName=""),i.loggedIn=!0,this.$el.html(this.template(i)),this.$(".logout").click(this.logout.bind(this))}else this.$el.html(this.template({loggedIn:!1}))}}),g=c.extend({initialize:function(i){i.template=i.PageHeaderLoginMobileTemplate,this.baseInitialize(i)}});return{LoginModal:l,SignupModal:h,PasswordModal:d,DesktopLoginArea:c.extend({initialize:function(i){i.template=i.PageHeaderLoginTemplate,this.baseInitialize(i)}}),MobileLoginArea:g}});
//# sourceMappingURL=LoginView.min.js.map