define(["jquery","underscore","marionette","globals","facebook"],function(o,e,i,t,n){var s=function(o,e,i){var t=new RegExp("([?&]"+e+"=)[^&]+",""),n=function(t){o+=t+e+"="+encodeURIComponent(i)};return o.indexOf("?")===-1?n("?"):t.test(o)?function(){o=o.replace(t,"$1"+encodeURIComponent(i))}():n("&"),o},c=function(e){return o.ajax({url:"https://api.bit.ly/v3/shorten",async:!0,data:{longUrl:e,apiKey:"R_244b3f625ae2e1fbdc77b2bab2607790",login:"flixstertomatoes"},dataType:"jsonp"})},a=function(){var o=window.screenLeft?window.screenLeft:window.screenX,e=window.screenTop?window.screenTop:window.screenY,i=o+window.innerWidth/2-287.5;return"status=0,location=0,menubar=0,width=575,height=450,top="+(e+window.innerHeight/2-225)+",left="+i},l=function(o,e){o=s(o,"utm_campaign","sharelinks"),o=s(o,"utm_source","twtr"),e.location="https://twitter.com/share?url="+encodeURIComponent(o)+"&via="+encodeURIComponent("RottenTomatoes"),e.focus()};return i.ItemView.extend({attributes:function(){return{id:"social-tools",class:"social-tools"}},initialize:function(o){t.fb_ready.done(this.onFbReady.bind(this)),this.template=o.SocialToolTemplate,this.facebookLikeId=0,o.movieId?this.forumLink=t.ForumHost+"/forum/category/2/"+o.movieId:o.tvSeriesId&&(this.forumLink=t.ForumHost+"/forum/category/4/"+o.tvSeriesId)},events:{"click .social-tools-facebook-like":"fbLike_click","click .social-tools-facebook-share":"fbShare_click","click .social-tools-twitter":"newTwitterWindow","click .social-tools-googleplus":"newGooglePlusWindow","click .social-tools-pinterest":"newPinterestWindow","click .social-tools-stumbleupon":"newStumbleUponWindow"},serializeData:function(){return{forumLink:this.forumLink}},onFbReady:function(){n.api("me/og.likes","get",{object:document.URL},this.facebookLikeResult.bind(this))},facebookLikeResult:function(o){null!==o&&void 0!==o.data&&o.data.length>0?(this.$(".social-tools-facebook-like").addClass("liked"),this.$(".fb_like").attr("src",t.StaticHost+"/images/social/social_fb_liked.png"),this.facebookLikeId=o.data[0].id):this.$(".social-tools-facebook-like").removeClass("liked")},facebookLike:function(e){o(".social-tools-facebook-like",e).hasClass("liked")?(o(".social-tools-facebook-like",e).removeClass("liked"),o(".fb_like").attr("src",t.StaticHost+"/images/social/social_fb_like.png"),n.api(this.facebookLikeId,"delete",function(o){})):(o(".social-tools-facebook-like",e).addClass("liked"),o(".fb_like").attr("src",t.StaticHost+"/images/social/social_fb_liked.png"),n.api("me/og.likes","post",{object:document.URL},function(o){}))},fbLike_click:function(e){var i=o(e.currentTarget);t.loginModel.isLoggedIn()&&t.loginModel.user.isFBUser()?this.facebookLike(i):t.fb_ready.done(function(){var e=i.attr("scope");void 0===e&&(e="email,publish_actions,user_friends"),n.login(function(e){e.authResponse?this.facebookLike(i):(console.log("User cancelled Facebook login or did not fully authorize."),o(".social-tools-facebook-like",i).removeClass("liked"),o(".fb_like",i).attr("src",t.StaticHost+"/images/social/social_fb_like.png"))}.bind(this),{scope:e})}.bind(this))},fbShare_click:function(){var o=document.URL;o=s(o,"utm_campaign","sharelinks"),o=s(o,"utm_source","fbk"),n.ui({method:"feed",link:o},function(o){})},newTwitterWindow:function(){var o=window.open("","_blank",a()),e=document.URL,i=c(e);i.success(function(i){i.data.length>0?l(i.data.url,o):l(e,o)}),i.error(function(){l(e,o)})},newPinterestWindow:function(){var e=o(".pinterestImage").attr("src"),i=document.title,t=document.URL;t=s(t,"utm_campaign","sharelinks"),t=s(t,"utm_source","pin"),window.open("https://pinterest.com/pin/create/link/?url="+encodeURIComponent(t)+"&media="+encodeURIComponent(e)+"&description="+encodeURIComponent(i),"_blank",a())},newGooglePlusWindow:function(){var o=document.URL;o=s(o,"utm_campaign","sharelinks"),o=s(o,"utm_source","google"),window.open("https://plus.google.com/share?url="+encodeURIComponent(o),"_blank",a())},newStumbleUponWindow:function(){var o=document.URL;o=s(o,"utm_campaign","sharelinks"),o=s(o,"utm_source","stumble"),window.open("https://www.stumbleupon.com/submit?url="+encodeURIComponent(o),"_blank",a())}})});
//# sourceMappingURL=SocialTool.min.js.map